<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>layout 后台大布局 - Layui</title>
    <link rel="stylesheet" href="./css/layui.css">
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/editormd.css" />
    <style type="text/css">
        .toolbar {
            border: 1px solid #ccc;
            height: 50px;
            line-height: 50px;
            margin-top: 50px;
        }
        
        .text {
            border: 1px solid #ccc;
            height: 400px;
        }
    </style>
</head>

<body class="layui-layout-body">


    <div style="margin-top: 10px;">
        <!-- 内容主体区域 -->
        <div style="float: right; margin-right:50px;margin-top:10px;">
            <button class="layui-btn layui-btn-normal layui-btn-radius" onclick="add()">添加</button>
        </div>
        <div style="clear: both;"></div>
        <div class="layui-table-box">
            <table class="layui-table" lay-data="{width:1300, url:'/group/allList', page:true, id:'idTest'}" lay-filter="demo">
                <thead>
                    <tr>

                        <th lay-data="{field:'id', width:80, sort: true, fixed: true}" id="ID">id</th>
                        <th lay-data="{field:'name', width:100}">姓名</th>
                        <th lay-data="{field:'grade'}">年级</th>
                        <th lay-data="{field:'name'}">组别</th>
                        <th lay-data="{field:'employment'}">毕业公司</th>
                        <th lay-data="{field:'photoUri'}">照片</th>
                        <th lay-data="{fixed: 'right', width:178, align:'center', toolbar: '#barDemo'}">操作</th>
                    </tr>
                </thead>
            </table>
        </div>
        <script type="text/html" id="barDemo">
            <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
        </script>
        <script src="./layui.js"></script>

        <script>
            //JavaScript代码区域
            layui.use('table', function() {
                var table = layui.table;
                //监听表格复选框选择
                table.on('checkbox(demo)', function(obj) {
                    console.log(obj)
                });
                //监听工具条
                table.on('tool(demo)', function(obj) {
                    var data = obj.data;
                    if (obj.event === 'detail') {
                        layer.msg('ID：' + data.id + ' 的查看操作');
                    } else if (obj.event === 'del') {
                        layer.confirm('真的删除行么', function(index) {
                            obj.del();
                            layer.close(index);
                        });
                    } else if (obj.event === 'edit') {
                        layer.alert('编辑行：<br>' + JSON.stringify(data))
                    }
                });

            });

            function add() {
                layui.use(['form', 'jquery', 'table'], function() {
                    var form = layui.form;
                    var $ = layui.jquery;
                    layer.open({
                        //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                        type: 1,
                        title: "添加毕业生信息",
                        area: ['30%', '50%'],
                        content: ` <div class="layui-row" id="test">
                    <div class="layui-col-md10">
                    <form class="layui-form" id="addEmployeeForm" onsubmit=" return checkImg('img_url','Label7')" action="/person/save" method="post">
                       
                        <div class="layui-form-item">
                                <label class="layui-form-label">照片</label>
        <div class="layui-input-block">
            <button type="button" class="layui-btn" id="upload1">上传图片</button>
            <input type="hidden" id="img_url" name="photoUri" value=""  required="required"/>
            <label id="Label7" class="control-label" style="color:red"></label>
            <div class="layui-upload-list">
                <img class="layui-upload-img" width="100px" height="80px" id="demo1"/>
            <p id="demoText"></p>
            </div>
        </div>
        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">姓名：</label>
                            <div class="layui-input-block">
                                <input type="text" name="name" id="text1" class="layui-input" onBlur="isChinese('text1','Label1')" placeholder="请输入中文"  required="required">
                                <label id="Label1" class="control-label" style="color:red"></label>
                            </div>
                        </div>
                       
                        <div class="layui-form-item">
                            <label class="layui-form-label">年级：</label>
                            <div class="layui-input-block">
                                <input type="text" name="grade" class="layui-input" placeholder="请输入如软件1606班xxx"  required="required">
                                <label id="Label3" class="control-label" style="color:red"></label>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">毕业公司：</label>
                            <div class="layui-input-block">
                                <input type="text" name="grade" class="layui-input" placeholder="请输入如软件1606班xxx"  required="required">
                                <label id="Label3" class="control-label" style="color:red"></label>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">组别：</label>
                            <div class="layui-input-block">
                                <select class="layui-input" name="group.id" id="deptSelect" lay-filter="pageFilter">                                                                    
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <input type="submit" class="layui-btn layui-btn-normal" lay-filter="demo1"></input>
                        </div>
                        </div>
                        
                    </form>
                </div>
            </div>`,
                        success: function(layero, index) {
                            $.get('/group/usableList', {}, function(data) {
                                var $html = "";
                                // console.log(data);
                                data.Group.forEach(function(element) {
                                    $html += "<option value='" + element.id + "'>" + element.name + "</option>";
                                })
                                $("select[name='group.id']").append($html);
                                form.render('select');
                            });

                        }
                    });
                    upload()
                    form.render();


                })
            }

            function isChinese(id1, id2) {
                var reg = /^[\u0391-\uFFE5]+$/;
                var obj = document.getElementById(id1);
                if (!reg.test(obj.value)) {
                    document.getElementById(id2).innerHTML = "<img src='images/error.png'>请输入正确格式文字!";
                    obj.mail.focus();
                    return false;
                } else {
                    document.getElementById(id2).innerHTML = "<img src='images/right.png'>";
                    return true;
                }
            }

            function upload() {
                layui.use('upload', function() {
                    var upload = layui.upload,
                        $ = layui.jquery;
                    var uploadInst = upload.render({
                        elem: '#upload1' //绑定元素
                            ,
                        url: '/file/uploadPersonImg',
                        before: function(obj) {
                            //预读本地文件示例，不支持ie8
                            obj.preview(function(index, file, result) {

                                $('#demo1').attr('src', result); //图片链接（base64）
                            });
                        },
                        field: 'fileModel.file',
                        done: function(res) {
                            console.log(res);
                            //如果上传失败
                            if (res.file == 0) {
                                layer.msg('上传成功');
                            } else if (res.file == 1) {
                                layer.msg('上传格式必须是jpg')
                            } else if (res.file == 2) {
                                layer.msg('上传图片超过400k')
                            } else if (res.file == 3) {
                                layer.msg('未知错误，联系管理员');
                            }

                            //上传成功
                            // alert("上传成功" + res.url);
                            console.log(res.url);
                            document.getElementById("img_url").value = res.url;

                        },
                        error: function() {
                            //演示失败状态，并实现重传
                            var demoText = $('#demoText');
                            demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                            demoText.find('.demo-reload').on('click', function() {
                                uploadInst.upload();
                            });
                        }
                    });
                });
            }
        </script>
</body>

</html>